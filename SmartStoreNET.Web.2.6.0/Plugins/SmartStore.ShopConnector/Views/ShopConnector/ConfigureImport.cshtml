@using SmartStore.ShopConnector;
@using SmartStore.ShopConnector.Models;
@using SmartStore.ShopConnector.Core;
@using SmartStore.ShopConnector.Extensions;
@using SmartStore.Web.Framework;
@using SmartStore.Web.Framework.UI;
@using Telerik.Web.Mvc.UI;
@model ConfigurationModel

<div class="alert alert-info">
	@Html.Raw(@T("Plugins.SmartStore.ShopConnector.AdminInstructionImport"))
</div>

<script type="text/javascript">
	function onRowDataBound_ImportConnection(e) {
		if (!e.dataItem.IsActive) {
			$(e.row).find('td').wrapInner('<span class="muted" />');
		}
	}
</script>

<div>
	@(Html.Telerik().Grid<ConnectionModel>()
		.Name("import-connection-grid")
		.DataKeys(keys => keys.Add(x => x.Id)
		.RouteKey("Id"))
		.Columns(c =>
		{
			c.Bound(x => x.Url)
				.Width(280)
				.ClientTemplate(@Html.NoteAndUrlLabel());
			c.Bound(x => x.PublicKey);
			c.Bound(x => x.SecretKey);
			c.Bound(x => x.IsActive)
				.Centered()
				.ClientTemplate(@Html.SymbolForBool("IsActive"));
			c.Bound(x => x.RequestCount)
				.Centered()
				.ReadOnly();
			c.Bound(x => x.LastRequest)
				.ReadOnly();
			c.Bound(x => x.LastProductCall)
				.ReadOnly();
			c.Template(x => @Html.GridButtons(false))
				.ClientTemplate(@Html.GridButtons(false))
				.Width(320);
		})
		.DataBinding(dataBinding =>
		{
			dataBinding.Ajax()
				.Select("ConnectionSelect", "ShopConnector", new { area = ShopConnectorCore.SystemName, isForExport = false });
		})
		.ToolBar(commands =>
		{
			commands.Custom()
				.Name("connection-import-insert-button")
				.HtmlAttributes(new { @class = "btn btn-link connection-grid-button connection-insert connection-forimport" })
				.Text("<i class='fa fa-plus'></i>&nbsp;" + @T("Plugins.SmartStore.ShopConnector.AddNewImportConnection"));
		})
		.Pageable(settings => settings.PageSize(Model.GridPageSize).Position(GridPagerPosition.Both))
		.ClientEvents(events => events.OnRowDataBound("onRowDataBound_ImportConnection"))
		.EnableCustomBinding(true)
	)
</div>
<div>
	<a href="javascript:void(0)" class="btn btn-below connection-action action-product-import"
	   data-url="@Url.Action("ProductFileSelect", "ShopConnectorImport", new { id = "0", area = ShopConnectorCore.SystemName })"
	   data-urlprogress="@Url.Action("ProductImportProgress", "ShopConnectorImport", new { area = ShopConnectorCore.SystemName })">
		<i class="fa fa-fw fa-gears"></i>&nbsp;@T("Plugins.SmartStore.ShopConnector.Action.ProductImport")
	</a>

	@if (Model.LogFileExists)
	{
		<a href="@Url.Action("ImportLog", "ShopConnectorImport", new { area = ShopConnectorCore.SystemName })" class="btn btn-below" target="LogFile">
			<i class="fa fa-fw fa-file-text-o"></i>&nbsp;@T("Plugins.SmartStore.ShopConnector.Action.ImportLogFile")
		</a>
	}
</div>